import{e as ee,c as te,o as ae,f as B,i as b,j as D,k as _,l as T,d as ie,m as A,s as v,n as re,u as oe,t as w,p as ne}from"./web.BkRLYnfb.js";/* empty css                       */function le(r){let a=!1;return async(...o)=>{if(!a){a=!0;try{await r(...o)}finally{a=!1}}}}const se=(...r)=>r.filter(a=>!!a).map(a=>typeof a!="object"?a:Object.entries(a).filter(([,o])=>!!o).map(([o])=>o)).flat().join(" ");var de=w("<svg preserveAspectRatio=none class=w-full><defs><clipPath><path id=waveform-draw stroke-width=0></path></clipPath></defs><g><rect class=track-bar width=100% height=100%></rect><rect class=hover-bar width=0 height=100%></rect><rect class=progress-bar height=100%></rect></g><!$><!/>"),ue=w("<svg><line y1=0 y2=100% stroke=red></svg>",!1,!0),ce=w('<div class="audio-player relative flex w-full items-stretch overflow-hidden rounded-xl"><div class=album-cover-wrapper></div><div class="ml-4 flex flex-1 flex-col justify-between px-3 py-4 pr-7"><div class="flex items-center gap-2"><span class=leading-none></span><!$><!/><svg viewBox="0 0 100 100"><rect x=20 y=30 width=5 height=40><animate attributeName=y calcMode=linear values=40;20;40 dur=1s begin=-0.2s repeatCount=indefinite></animate><animate attributeName=height calcMode=linear values=20;60;20 dur=1s begin=-0.2s repeatCount=indefinite></animate></rect><rect x=50 y=30 width=5 height=40><animate attributeName=y calcMode=linear values=40;20;40 dur=1.1s begin=-0.1s repeatCount=indefinite></animate><animate attributeName=height calcMode=linear values=20;60;20 dur=1.1s begin=-0.1s repeatCount=indefinite></animate></rect><rect x=80 y=30 width=5 height=40><animate attributeName=y calcMode=linear values=40;20;40 dur=1.2s begin=0s repeatCount=indefinite></animate><animate attributeName=height calcMode=linear values=20;60;20 dur=1.2s begin=0s repeatCount=indefinite></animate></rect></svg></div><div class=audio-bar-wrap></div><div class=audio-controls><!$><!/><!$><!/><span class="font-mono leading-none"></span>/<span class="font-mono leading-none"></span></div></div><audio>'),ve=w("<img class=album-cover>"),he=w('<span class="flex-1 truncate text-xs text-gray-600">'),ge=w("<div class=audio-pointer>"),me=w('<div class="audio-bar-container bg-gray-300"><div class="audio-loaded bg-gray-500"></div><div class="audio-played bg-gray-800">'),pe=w('<button title=play aria-label="play audio"class="mr-3 h-6 w-6 rounded p-1 hover:bg-gray-300"><svg viewBox="0 0 1024 1024"class="h-full w-full"><path d="M210.57049599 921.6l0-819.2 682.66666667 409.6zM716.18073599 512l-414.580736-248.88388267 0 497.76776534z">'),fe=w('<button title=paused aria-label="paused audio"class="mr-3 h-6 w-6 rounded p-1 hover:bg-gray-300"><svg viewBox="0 0 1024 1024"class="h-full w-full"><path d="M220.72888889 172.18370333h97.09036999v679.63259334H220.72888889V172.18370333z m485.45185223 0h97.09036999v679.63259334h-97.09036999V172.18370333z">'),ye=w('<button title="stop loop"aria-label="stop loop play"class="mr-3 h-6 w-6 rounded p-1 hover:bg-gray-300"><svg viewBox="0 0 29 32"class="h-full w-full"><path d="M9.333 9.333h13.333v4l5.333-5.333-5.333-5.333v4h-16v8h2.667v-5.333zM22.667 22.667h-13.333v-4l-5.333 5.333 5.333 5.333v-4h16v-8h-2.667v5.333z">'),$e=w('<button title=loop aria-label="loop play"class="mr-3 h-6 w-6 rounded p-1 hover:bg-gray-300"><svg viewBox="0 0 29 32"class="h-full w-full"><path d="M2.667 7.027l1.707-1.693 22.293 22.293-1.693 1.707-4-4h-11.64v4l-5.333-5.333 5.333-5.333v4h8.973l-8.973-8.973v0.973h-2.667v-3.64l-4-4zM22.667 17.333h2.667v5.573l-2.667-2.667v-2.907zM22.667 6.667v-4l5.333 5.333-5.333 5.333v-4h-10.907l-2.667-2.667h13.573z">');const G="ðŸŽµ ";class be{constructor(a,o,p){this.audioId=a,this.audio=o,this.setStateSignal=p}enabledPointer=!1;draggingPointer=!1;notify=()=>{document.documentElement.dispatchEvent(new CustomEvent("audio-playback-change",{detail:this.audioId}))};toggle=le(async()=>{this.audio.paused?await this.audio.play():this.audio.pause(),this.notify()});setLoop=()=>{this.audio.loop=!this.audio.loop,this.setStateSignal(a=>({...a,loop:this.audio.loop}))};setTime=a=>{const{left:o,width:p}=a.currentTarget.getBoundingClientRect(),h=a.clientX-o;h>p||(this.audio.currentTime=h/p*this.audio.duration,this.notify())};getWidth=a=>Math.max(a/this.audio.duration*100,0).toFixed(2)+"%";dragPointer=a=>{const{left:o,width:p}=a.currentTarget.getBoundingClientRect(),h=a.clientX-o;h>p||requestAnimationFrame(()=>{if(!this.enabledPointer)return;const P={pos:h,percent:Math.max(h/p*100,0).toFixed(2)+"%",show:!0};console.log(P),this.draggingPointer?this.setStateSignal(M=>({...M,played:h/p*this.audio.duration,pointer:P})):this.setStateSignal(M=>({...M,pointer:P}))})};enablePointer=()=>{this.enabledPointer=!0};onPointerDragStart=()=>{this.draggingPointer=!0,window.addEventListener("mouseup",this.onPointerDragEnd)};onPointerDragEnd=()=>{this.draggingPointer=!1,window.removeEventListener("mouseup",this.onPointerDragEnd),this.audio.play().catch(console.error)};disablePointer=()=>{this.draggingPointer||(this.enabledPointer=!1,this.setStateSignal(a=>({...a,pointer:{pos:0,percent:"0%",show:!1}})))}}const we=r=>(()=>{var a=b(de),o=a.firstChild,p=o.firstChild,h=p.firstChild,P=o.nextSibling,M=P.firstChild,u=M.nextSibling,g=u.nextSibling,k=P.nextSibling,[m,F]=D(k.nextSibling);return _(a,(()=>{var d=B(()=>!!r.showPointer);return()=>d()&&(()=>{var c=b(ue);return T(e=>{var f=r.pointer,t=r.pointer;return f!==e.e&&v(c,"x1",e.e=f),t!==e.t&&v(c,"x2",e.t=t),e},{e:void 0,t:void 0}),c})()})(),m,F),T(d=>{var c=r.waveform.viewBox,e=`:${r.waveform.id}:`,f=r.waveform.d,t=`url(#:${r.waveform.id}:)`,y=r.played;return c!==d.e&&v(a,"viewBox",d.e=c),e!==d.t&&v(p,"id",d.t=e),f!==d.a&&v(h,"d",d.a=f),t!==d.o&&v(P,"clip-path",d.o=t),y!==d.i&&v(g,"width",d.i=y),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),a})();function Pe({id:r,t:a,a1:o,a2:p,c:h,s:P,w:M}){const[u,g]=te({ready:!1,played:0,loaded:0,duration:0,paused:!0,loop:!1,loading:!1,error:!1,pointer:{pos:0,percent:"0%",show:!1},waveform:void 0});let k,m;const F=async c=>{const e=await fetch(`/static/${c}`).then(l=>l.arrayBuffer()).then(l=>new Float32Array(l)),f=370,t=16,y=-45,R=0,z=f/e.length,L=t/2;let N="";for(let l=0;l<e.length;l++){const C=Math.max(Math.min(e[l],0),y),W=Math.ceil(l*z),I=Math.ceil(C==0?L:C/y*L),j=Math.ceil(z-R),X=Math.ceil(C==0?1:Math.max((1-C/y)*t,1));N+=`M ${W} ${I} h${j} v ${X} h${-j} Z `}g(l=>({...l,waveform:{id:"r3",viewBox:`0 0 ${f} ${t}`,d:N}}))};ae(()=>{if(!k)return;M&&F(M).catch(console.error);const c=document.title,e=new be(r,k,g),f=[x(e.audio,"durationchange",()=>g(t=>({...t,duration:e.audio.duration}))),x(e.audio,"playing",()=>g(t=>({...t,loading:!0}))),x(e.audio,"error",()=>g(t=>({...t,error:!0}))),x(e.audio,"waiting",()=>g(t=>({...t,loading:!0}))),x(e.audio,"ended",()=>{document.title=c,g(t=>({...t,paused:!0}))}),x(e.audio,"play",()=>{e.audio.dataset.audioTitle&&(document.title=`${G}${e.audio.dataset.audioTitle}`),g(t=>({...t,paused:!1}))}),x(e.audio,"pause",()=>{e.audio.dataset.audioTitle==document.title.slice(G.length)&&(document.title=c),g(t=>({...t,paused:!0}))}),x(e.audio,"timeupdate",()=>g(t=>({...t,played:e.audio.currentTime,loading:!1}))),x(e.audio,"suspend",()=>g(t=>({...t,loaded:e.audio.buffered.length>0?e.audio.buffered.end(0):0}))),x(document.documentElement,"audio-playback-change",t=>{if(t instanceof CustomEvent){const y=t.detail;if(!y)return;y!==r&&e.audio.pause()}})];g(t=>({...t,duration:e.audio.duration})),m=e,ne(()=>f.forEach(t=>t()))});const d=B(()=>{const c=u().loaded,e=u().played;return{loaded:m?.getWidth(c)??"0%",played:m?.getWidth(e)??"0%"}});return(()=>{var c=b(ce),e=c.firstChild,f=e.nextSibling,t=f.firstChild,y=t.firstChild,R=y.nextSibling,[z,L]=D(R.nextSibling),N=z.nextSibling,l=t.nextSibling,C=l.nextSibling,W=C.firstChild,[I,j]=D(W.nextSibling),X=I.nextSibling,[q,Q]=D(X.nextSibling),O=q.nextSibling,U=O.nextSibling,Y=U.nextSibling,E=f.nextSibling;_(e,(()=>{var n=B(()=>!!h?.src);return()=>n()&&(()=>{var i=b(ve);return T(s=>{var S=h.src,$=h.description||"Album Cover";return S!==s.e&&v(i,"src",s.e=S),$!==s.t&&v(i,"alt",s.t=$),s},{e:void 0,t:void 0}),i})()})()),_(y,a),_(t,o&&(()=>{var n=b(he);return _(n,o),n})(),z,L),l.$$click=n=>m?.setTime(n),l.$$mousedown=()=>m?.onPointerDragStart(),l.$$mouseover=()=>m?.enablePointer(),l.$$mouseout=()=>m?.disablePointer(),l.$$mousemove=n=>m?.dragPointer(n),_(l,(()=>{var n=B(()=>!!u().waveform);return()=>n()?ie(we,{get waveform(){return u().waveform},get played(){return d().played},get showPointer(){return u().pointer.show},get pointer(){return u().pointer.percent}}):[(()=>{var i=b(ge);return T(s=>{var S=u().pointer.show?"block":"none",$=`translateX(${u().pointer.pos}px)`;return S!==s.e&&((s.e=S)!=null?i.style.setProperty("display",S):i.style.removeProperty("display")),$!==s.t&&((s.t=$)!=null?i.style.setProperty("transform",$):i.style.removeProperty("transform")),s},{e:void 0,t:void 0}),i})(),(()=>{var i=b(me),s=i.firstChild,S=s.nextSibling;return T($=>{var H=d().loaded,V=d().played;return H!==$.e&&(($.e=H)!=null?s.style.setProperty("width",H):s.style.removeProperty("width")),V!==$.t&&(($.t=V)!=null?S.style.setProperty("width",V):S.style.removeProperty("width")),$},{e:void 0,t:void 0}),i})()]})()),_(C,(()=>{var n=B(()=>!!u().paused);return()=>n()?(()=>{var i=b(pe);return i.$$click=()=>m?.toggle(),A(),i})():(()=>{var i=b(fe);return i.$$click=()=>m?.toggle(),A(),i})()})(),I,j),_(C,(()=>{var n=B(()=>!!u().loop);return()=>n()?(()=>{var i=b(ye);return i.$$click=()=>m?.setLoop(),A(),i})():(()=>{var i=b($e);return i.$$click=()=>m?.setLoop(),A(),i})()})(),q,Q),_(O,()=>K(u().played)),_(Y,()=>K(u().duration));var Z=k;return typeof Z=="function"?oe(Z,E):k=E,v(E,"src",`/static/${P}`),re(E,"controls",!1),v(E,"data-audio-title",a),v(E,"data-audio-id",r),v(E,"data-audio-artist",o),v(E,"data-audio-album",p),T(n=>{var i=h?void 0:u().paused?"paused":"running",s=se("audio-loading-icon w-4 fill-gray-600",u().loading?"opacity-100":"opacity-0");return i!==n.e&&((n.e=i)!=null?e.style.setProperty("animation-play-state",i):e.style.removeProperty("animation-play-state")),s!==n.t&&v(N,"class",n.t=s),n},{e:void 0,t:void 0}),A(),c})()}const J=r=>r.toString().padStart(2,"0"),K=r=>`${J(Math.floor(r/60)|0)}:${J(Math.floor(r%60)|0)}`,x=(r,a,o)=>(r.addEventListener(a,o),()=>r.removeEventListener(a,o));ee(["mousemove","mouseout","mouseover","mousedown","click"]);export{Pe as AudioPlayer};
