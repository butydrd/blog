import{i as v,q as T,v as N,m as U,t as p,c as P,f as I,w as M,j as R,k as b,d as $,l as E,u as A,n as O,x as C,F as z,s as L,o as F,p as H}from"./web.BkRLYnfb.js";const q="modulepreload",B=function(o){return"/"+o},j={},D=function(l,i,a){let u=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),n=t?.nonce||t?.getAttribute("nonce");u=Promise.allSettled(i.map(e=>{if(e=B(e),e in j)return;j[e]=!0;const r=e.endsWith(".css"),h=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${h}`))return;const m=document.createElement("link");if(m.rel=r?"stylesheet":q,r||(m.as="script"),m.crossOrigin="",m.href=e,n&&m.setAttribute("nonce",n),document.head.appendChild(m),r)return new Promise((c,s)=>{m.addEventListener("load",c),m.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))})}))}function d(t){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=t,window.dispatchEvent(n),!n.defaultPrevented)throw t}return u.then(t=>{for(const n of t||[])n.status==="rejected"&&d(n.reason);return l().catch(d)})};/**
 * @license lucide v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=["svg",K,[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]]];var V=p("<svg>");function W(o){const[l,i,a]=o.icon,u=n=>Object.entries(n).map(([e,r])=>`${e}="${r}"`).join(" "),d=a?.map(([n,e])=>`<${n} ${u(e)}/>`).join(`
`),t={...i,...o};return(()=>{var n=v(V);return T(n,N(t,{innerHTML:d}),!0),U(),n})()}var G=p('<li class="my-6 fade-in">'),J=p('<a class="decoration-dashed underline-offset-4 hover:underline"><h2 class="inline text-lg">'),X=p('<p class="mt-2 opacity-60 [&amp;>mark]:bg-inherit [&amp;>mark]:text-red-500">'),Y=p('<div class=animate-pulse><div class="h-8 w-[40%] bg-slate-200"></div><div class="my-2 h-4 bg-slate-200"></div><div class="my-2 h-4 bg-slate-200"></div><div class="my-2 h-4 bg-slate-200">'),Z=p('<div class="mt-8 text-red-600">Oops, an error occurred: <!$><!/>'),ee=p("<div class=mt-8>"),te=p("<ul>"),ne=p('<label class="relative block"><span class="absolute inset-y-0 left-0 flex items-center pl-3 opacity-75"><!$><!/><span class=sr-only>Search</span></span><input placeholder="Search for anything..."type=text name=search autocomplete=off class="border-skin-fill bg-skin-fill focus:border-skin-accent block w-full rounded border border-opacity-40 py-3 pl-10 pr-3 placeholder:italic placeholder:text-opacity-75 focus:outline-none">');let _;const x=[],re=o=>{const[l,i]=P(!1),a=()=>{i(!0)},u=()=>{const d=o.current;d&&(_?.unobserve(d),x.length==0&&(_=void 0))};return F(()=>{const d=o.current;d&&(_||(_=new IntersectionObserver((t,n)=>{for(const e of t){if(!e.isIntersecting)continue;const r=x.findIndex(h=>h[0]===e.target);r<0&&n.unobserve(e.target),x[r][1](),n.unobserve(e.target),x.splice(r,1)}},{root:null,rootMargin:"0px",threshold:0})),_.observe(d),x.push([d,a]),H(u))}),l},se=o=>{let l={current:void 0},i=!1;const[a,u]=P(void 0),d=re(l);return M(async()=>{if(!(!d()||i))try{const t=await o.result.data();u(t),i=!0}catch(t){console.log(t)}}),(()=>{var t=v(G),n=l.current;return typeof n=="function"?A(n,t):l.current=t,b(t,()=>{const e=a();return e?[(()=>{var r=v(J),h=r.firstChild;return b(h,()=>e.meta.title),E(()=>L(r,"href",e.url)),r})(),(()=>{var r=v(X);return E(()=>O(r,"innerHTML",e.excerpt)),r})()]:v(Y)}),E(e=>{var r=o.result.score,h=o.result.id;return r!==e.e&&L(t,"data-score",e.e=r),h!==e.t&&L(t,"data-id",e.t=h),e},{e:void 0,t:void 0}),t})()},oe=o=>{const l=I(()=>o.results?.results||[]);return[$(C,{get when(){return o.exception},get children(){var i=v(Z),a=i.firstChild,u=a.nextSibling,[d,t]=R(u.nextSibling);return b(i,()=>o.exception,d,t),i}}),$(C,{get when(){return!o.exception&&o.existent},get children(){var i=v(ee);return b(i,(()=>{var a=I(()=>!!o.pending);return()=>a()?"搜尋中...":`找到 ${l().length} 個關於 "${o.words}" 的結果`})()),i}}),$(C,{get when(){return l().length>0},get children(){var i=v(te);return b(i,$(z,{get each(){return l()},children:a=>$(se,{result:a})})),i}})]},le=()=>{let o,l,i=!1,a,u;const[d,t]=P(""),[n,e]=P({finding:!1,results:void 0,exception:void 0,term:void 0}),r=I(()=>d().trim()),h=c=>{const s=[];let g="",w=!1;a||(a=new Intl.Segmenter(document.documentElement.lang,{granularity:"word"}));for(let y=0;y<c.length;y++){const f=c[y];if(f==='"'||f==="“"){if(w)s.push(g),g="";else if(g.length>0){const k=[...a.segment(g)].map(S=>S.segment).filter(S=>S.trim().length!=0);s.push(...k),g=""}w=!w}else g+=f}if(g.length>0){const y=[...a.segment(g)].map(f=>f.segment).filter(f=>f.trim().length!=0);s.push(...y)}return s},m=async c=>{if(e({finding:c.length!=0,results:void 0,exception:void 0,term:void 0}),c.length!=0)try{if(!l){if(u){u=c;return}if(u=c,l=await D(()=>import(`${location.origin}/search/pagefind.js`),[]),!l.options){e({finding:!1,results:void 0,exception:"Failed to load search module",term:void 0});return}console.log("start options",l.options),await l.options({basePath:"/search/"}),console.log("start init",l),await l.init(),console.log("initialized"),c=u,u=void 0}a||(a=new Intl.Segmenter(document.documentElement.lang,{granularity:"word"}));const s=h(c).map(w=>`"${w}"`).join(" "),g=await l.search(s);console.log("term",s,"results: ",g.results.length),e({term:s,finding:!1,results:g,exception:void 0})}catch(s){u=void 0,s instanceof Error&&e({finding:!1,results:void 0,exception:s.message,term:void 0})}};return queueMicrotask(()=>{const s=new URLSearchParams(location.search).get("q")||"";t(s),i=!0}),M(()=>{const c=r();if(console.log("喵喵喵",c),m(c).catch(console.error),!i)return;const s=new URL(window.location.href);s.searchParams.set("q",c),s.search!=window.location.search&&history.replaceState({path:s.toString()},"",s.toString())}),[(()=>{var c=v(ne),s=c.firstChild,g=s.firstChild,[w,y]=R(g.nextSibling);w.nextSibling;var f=s.nextSibling;b(s,$(W,{icon:Q,class:"h-5 w-5"}),w,y),f.addEventListener("change",S=>t(S.currentTarget.value));var k=o;return typeof k=="function"?A(k,f):o=f,E(()=>O(f,"value",d())),c})(),$(oe,{get existent(){return r().length>0},get pending(){return n().finding},get results(){return n().results},get exception(){return n().exception},get words(){return r()}})]};export{le as SearchInput};
